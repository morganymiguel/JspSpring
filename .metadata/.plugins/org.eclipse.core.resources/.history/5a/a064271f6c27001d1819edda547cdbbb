package kr.or.ddit.servlet01;
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.annotation.*;

//@WebServlet("/image") //요청을 받는다.
public class ImageServlet extends HttpServlet{
		
		
		public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException, ServletException {
			//요청을 받는다.
			
			
			String imageName = req.getParameter("imageName");//parameter를 넘긴다.
			if(imageName == null || imageName.isEmpty()){
				//imageName.isEmpty()와 "".equals(imageName)
				//개발자인 나에게 문제가 없다는 걸 client에게 알려야한다.
				resp.sendError(400,"필수 파라미터 누락, 이미지명 없음.");
				return;
				
			}
				
			String mime = getServletContext().getMimeType(imageName);
			resp.setContentType(mime);
			//String mime ="image/jpeg"
			//resp.setContentType(mime);
			
			//resp.setContentType("image/jpeg; charset=UTF-8");//필요한 파일의 mime를 검색을 하고, 확장자를 찾는다.
			String imageFolder = getServletContext().getInitParameter("imageFolderPath");
			//String imageName = "cat1.jpg";
			
			File imageFile = new File(imageFolder, imageName);
			if(!imageFile.exists()){
				resp.sendError(404,imageName+"에 해당 파일이 없음.");
				return;
				
			}
			byte[] buffer = new byte[1024];
			int length = -1;
			FileInputStream fis = new FileInputStream(imageFile);//빨대라 생각해라, 병에서 땡겨와
			OutputStream os = resp.getOutputStream();
			while((length = fis.read(buffer))!= -1){
				os.write(buffer, 0, length);//stream copy
			
			}
			fis.close();
			os.close();
					
		}
}